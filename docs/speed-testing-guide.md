# 🚀 多租户应用速度测试系统

## 功能概述

本系统提供全面的性能测试和优化指导，包括：

### ✅ 测速报告
- 测试北京、上海、广州等10个主要城市的访问速度
- 测量网络延迟和丢包率
- 模拟真实用户访问场景

### ✅ 功能测试
- 检测页面是否能完整加载
- 验证各种API接口是否能成功调用
- 测试重试机制和错误处理

### ✅ 优化指导方案
- 基于测试结果设计CDN加速方案
- 提供API性能优化建议
- 生成详细的实施计划和成本估算

## 快速开始

### 1. 安装依赖
```bash
npm install
```

### 2. 运行全面测试
```bash
node test-speed.js
```

### 3. 运行单独测试
```bash
# 速度测试
node scripts/speed-test.js

# 功能测试
node scripts/functional-test.js

# 优化指导
node scripts/optimization-guide.js
```

## 测试配置

### 测试城市
系统默认测试以下10个城市：
- 北京 (华北)
- 上海 (华东)
- 广州 (华南)
- 深圳 (华南)
- 杭州 (华东)
- 成都 (西南)
- 武汉 (华中)
- 西安 (西北)
- 重庆 (西南)
- 南京 (华东)

### 测试端点
基于你的DNS配置，测试以下端点：
- https://rent.mornscience.com
- https://job.mornscience.com
- https://social.mornscience.com
- https://deepfake-detector.mornscience.com
- https://accelerator.mornscience.com

### API测试
每个端点都会测试以下API：
- `/api/auth/login`
- `/api/chat/send`
- `/api/payment/charge`
- `/api/chat/history`

## 报告解读

### 性能评分 (0-100)
- **90-100**: 优秀 - 无需优化
- **70-89**: 良好 - 可选择性优化
- **50-69**: 一般 - 建议优化
- **30-49**: 较差 - 需要立即优化
- **0-29**: 很差 - 需要全面重构

### 关键指标
- **平均延迟**: < 200ms 优秀，> 500ms 需要优化
- **丢包率**: < 2% 优秀，> 10% 需要优化
- **成功率**: > 95% 优秀，< 80% 需要修复

## 优化建议

### CDN加速
- **阿里云CDN**: 推荐用于国内用户
- **腾讯云CDN**: 推荐用于游戏和视频
- **Cloudflare**: 推荐用于全球用户

### API优化
- **缓存策略**: Redis缓存热点数据
- **压缩优化**: Gzip/Brotli压缩
- **负载均衡**: 多区域部署

### 成本估算
- **CDN服务**: ¥500/月 (¥6000/年)
- **基础设施**: ¥300/月 (¥3600/年)
- **开发实施**: ¥5000 (一次性)

## 实施计划

### 第一阶段 (1-2周)
- 配置CDN服务
- 设置DNS解析
- 启用HTTPS
- 配置基础缓存

### 第二阶段 (2-3周)
- 实现API缓存
- 优化数据库查询
- 配置负载均衡
- 设置监控告警

### 第三阶段 (3-4周)
- 部署边缘计算
- 实现智能路由
- 优化图片和静态资源
- 配置安全防护

## 监控和维护

### 定期测试
- 建议每周运行一次完整测试
- 监控关键指标变化
- 及时发现问题并优化

### 性能基准
- 建立性能基准线
- 跟踪优化效果
- 持续改进

## 故障排除

### 常见问题
1. **测试失败**: 检查网络连接和端点可用性
2. **延迟过高**: 考虑部署CDN或更换服务器位置
3. **丢包严重**: 检查网络质量和ISP线路
4. **API错误**: 检查服务器配置和代码逻辑

### 调试模式
```bash
# 启用详细日志
DEBUG=* node test-speed.js

# 只测试特定城市
CITIES=北京,上海 node test-speed.js

# 只测试特定端点
ENDPOINTS=rent,job node test-speed.js
```

## 技术架构

### 测试框架
- **速度测试**: 模拟多城市访问，测量延迟和丢包
- **功能测试**: 验证页面加载和API调用
- **优化指导**: 基于测试结果生成建议

### 报告系统
- **JSON格式**: 结构化数据，便于分析
- **控制台输出**: 实时显示测试进度
- **文件保存**: 自动保存到logs目录

### 扩展性
- **模块化设计**: 易于添加新的测试类型
- **配置驱动**: 通过配置文件自定义测试参数
- **插件系统**: 支持自定义测试逻辑

## 贡献指南

### 添加新测试
1. 在`scripts/`目录创建新的测试模块
2. 实现标准的测试接口
3. 在`run-comprehensive-test.js`中集成

### 改进建议
1. Fork项目
2. 创建功能分支
3. 提交Pull Request

## 许可证

MIT License - 详见LICENSE文件 